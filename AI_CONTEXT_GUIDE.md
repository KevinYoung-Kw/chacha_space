# AI 上下文信息指南

## 📚 AI 可以读取的信息

叉叉（Cha Cha）AI 可以实时访问以下用户状态信息，这些信息会在每次对话时作为上下文传递给 AI。

---

## 🎯 完整的上下文信息

### 1. 用户基础信息
```typescript
- 用户昵称: ${userState.userName || '用户'}
- 当前日期: 2026年1月17日 星期五（动态获取）
```

### 2. 📝 待办事项（Todo）
```typescript
- 待办事项总数: X个
- 未完成数量: Y个
- 具体的待办列表（包含内容、优先级、分类、完成状态）
```

**AI 可以：**
- ✅ 知道你有多少待办事项
- ✅ 知道哪些已完成，哪些未完成
- ✅ 看到待办事项的具体内容（通过工具调用时）
- ✅ 主动提醒你处理优先级高的任务
- ✅ 建议你合理安排时间

**示例场景：**
```
用户："我今天要做什么？"
AI：看到你有3个待办（2个未完成），会主动提醒未完成的事项
```

### 3. 💧 健康数据（Health）

#### 喝水记录
```typescript
- 今日喝水: 1200ml / 2000ml
- 喝水历史记录（时间戳）
```

**AI 可以：**
- ✅ 知道你今天喝了多少水                                            
- ✅ 知道距离目标还差多少
- ✅ **主动提醒你喝水**（如果发现喝水不足）
- ✅ 记录你每次喝水的时间和量

**示例场景：**
```
AI 检测到你的喝水量只有 1200ml/2000ml（60%）
AI 会主动说："嘿，记得补充水分哦~ 今天才喝了 1200ml，再来一杯吧！💧"
```

#### 热量记录
```typescript
- 今日热量: 1500kcal / 2000kcal
```

#### 睡眠记录
```typescript
- 昨晚睡眠: 7小时
```

#### 运动记录
```typescript
- 今日运动: 30分钟
```

### 4. 🌤️ 天气信息
```typescript
- 当前天气: 北京 15°C 晴天
- 未来3天预报
```

**AI 可以：**
- ✅ 知道你所在城市的天气
- ✅ 根据天气给出穿搭建议
- ✅ 根据天气调整对话氛围

---

## 🔧 AI 可以执行的操作（工具/Tools）

### 1. 待办事项管理
```typescript
✅ addTodo(item, priority, category)
   - 添加新的待办事项
   - 设置优先级（high/medium/low）
   - 设置分类（health/work/dev/content）

✅ toggleTodo(text)
   - 完成或取消完成待办事项
   - 支持模糊匹配

✅ deleteTodo(text)
   - 删除待办事项
```

**触发示例：**
- "帮我记一下明天要开会"
- "提醒我写代码"
- "完成了那个会议"
- "删掉写代码这个任务"

### 2. 天气查询
```typescript
✅ getWeather(city, days)
   - 查询指定城市天气
   - 获取未来N天预报（1-7天）
```

**触发示例：**
- "北京天气怎么样？"
- "今天穿什么？"
- "明天要带伞吗？"

### 3. 健康追踪
```typescript
✅ addWater(amount)
   - 记录喝水量（默认250ml）
   - 自动更新进度

✅ getHealthStatus(type)
   - 查询健康数据
   - 类型：water/calories/sleep/exercise/all
```

**触发示例：**
- "我喝了一杯水"
- "记录喝水 500ml"
- "我的健康数据怎么样？"
- "今天喝了多少水？"

### 4. 神秘占卜
```typescript
✅ drawTarot(question)
   - 进行三张牌占卜（过去-现在-未来）
   - 可以带上问题
```

**触发示例：**
- "帮我占卜一下"
- "今天运势如何？"
- "占卜一下我的爱情"

### 5. 面板控制
```typescript
✅ openPanel(panel)
   - 打开指定功能面板
   - 面板类型：weather/health/fortune/todo/skills/voice
```

**触发示例：**
- "打开天气面板"
- "看看我的待办"
- "显示健康数据"

---

## 🤖 AI 的主动行为

### 1. 健康提醒 💧
AI 会主动关注你的健康数据并提醒：

```typescript
// 喝水不足时
if (water.current < water.goal * 0.7) {
  AI: "记得补充水分哦~ 今天才喝了 XXXml，再来一杯吧！💧"
}

// 待办太多时
if (todos.未完成数量 > 5) {
  AI: "待办有点多呀，要不要我帮你整理一下优先级？"
}
```

### 2. 智能建议
基于上下文信息，AI 会给出个性化建议：

- **天气相关**："今天15°C，建议穿薄外套~"
- **时间管理**："你有3个高优先级任务，建议先完成XXX"
- **健康关怀**："昨晚只睡了5小时，今天记得早点休息哦"

### 3. 自动打开面板
当 AI 执行某个操作时，会自动打开相关面板：

```typescript
addTodo → 自动打开 todo 面板
addWater → 自动打开 health 面板
getWeather → 自动打开 weather 面板
drawTarot → 自动打开 fortune 面板
```

---

## 📊 数据流向图

```
┌─────────────────────────────────────────────────────────────┐
│                         用户界面 (App.tsx)                    │
│                                                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │  待办列表 │  │ 健康数据  │  │ 天气信息  │  │ 用户资料  │   │
│  │  todos   │  │healthData │  │ weather  │  │userProfile│   │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘   │
│       │            │             │             │           │
│       └────────────┴─────────────┴─────────────┘           │
│                        │                                     │
│                        ▼                                     │
│              ┌──────────────────┐                           │
│              │   userState 对象  │                           │
│              └────────┬─────────┘                           │
└───────────────────────┼─────────────────────────────────────┘
                        │
                        ▼
        ┌───────────────────────────────────┐
        │  generateAssistantResponse()      │
        │  (geminiService.ts)               │
        │                                   │
        │  1. 构建 stateContext 字符串      │
        │  2. 添加到 systemPrompt          │
        │  3. 发送给 MiniMax API           │
        └───────────────┬───────────────────┘
                        │
                        ▼
        ┌───────────────────────────────────┐
        │     MiniMax AI (叉叉)             │
        │                                   │
        │  可见信息：                        │
        │  • 用户昵称                        │
        │  • 待办事项（数量+明细）            │
        │  • 喝水进度                        │
        │  • 热量摄入                        │
        │  • 睡眠时长                        │
        │  • 运动时长                        │
        │  • 当前天气                        │
        │  • 当前日期时间                    │
        └───────────────┬───────────────────┘
                        │
                        ▼
        ┌───────────────────────────────────┐
        │   AI 决策和工具调用                │
        │                                   │
        │  • 生成回复文本                    │
        │  • 调用工具 (addTodo等)           │
        │  • 主动提醒和建议                  │
        └───────────────┬───────────────────┘
                        │
                        ▼
        ┌───────────────────────────────────┐
        │   执行 Actions                     │
        │   (修改应用状态)                   │
        │                                   │
        │  • setTodos()                     │
        │  • setHealthData()                │
        │  • setActivePanel()               │
        └───────────────────────────────────┘
```

---

## 🔍 实际示例

### 示例 1: AI 主动提醒喝水

**场景：**
```typescript
// 当前状态
healthData.water = { current: 800, goal: 2000 }  // 只喝了40%

// 用户随便说了句话
用户: "今天天气真好"
```

**AI 的上下文信息：**
```
【当前用户状态】
- 用户昵称: Kevin
- 待办事项: 3个 (2个未完成)
- 今日喝水: 800ml / 2000ml  ⚠️ 不足
- 今日热量: 1200kcal / 2000kcal
- 昨晚睡眠: 7小时
- 今日运动: 30分钟
- 当前天气: 北京 15°C 晴天
```

**AI 回复：**
```
"嗯嗯，天气确实不错呀~ 不过注意到你今天才喝了800ml水，
记得多补充水分哦！要不要我帮你记录一下？💧"
```

### 示例 2: AI 查看待办并给建议

**场景：**
```typescript
// 当前状态
todos = [
  { text: "完成项目文档", completed: false, priority: "high" },
  { text: "准备周会", completed: false, priority: "high" },
  { text: "回复邮件", completed: false, priority: "medium" },
  { text: "锻炼30分钟", completed: true, priority: "low" }
]

// 用户询问
用户: "我今天要做什么？"
```

**AI 的上下文信息：**
```
【当前用户状态】
- 待办事项: 4个 (3个未完成)
  ⚠️ 其中2个是高优先级
```

**AI 回复：**
```
"看到你有2个高优先级任务还没完成：
1. 完成项目文档
2. 准备周会

建议先把这两个搞定，然后再处理其他的~ 需要我帮你打开待办面板吗？"

// 同时自动调用 openPanel('todo')
```

### 示例 3: AI 综合健康提醒

**场景：**
```typescript
// 当前状态（下午5点）
healthData = {
  water: { current: 600, goal: 2000 },      // 喝水不足
  exercise: { current: 0, goal: 30 },       // 还没运动
  sleep: { current: 5, goal: 8 }            // 昨晚睡眠不足
}

// 用户询问
用户: "感觉有点累"
```

**AI 回复：**
```
"注意到你昨晚只睡了5小时，今天也才喝了600ml水，
难怪会觉得累呢~ 建议：
1. 现在补充点水分
2. 晚上早点休息
3. 今天记得运动一下放松

要不要我帮你打开健康面板看看详细数据？"
```

---

## 🎯 关键要点

1. **AI 可以实时读取所有用户状态**
   - 待办事项、健康数据、天气信息等

2. **AI 会主动关注并提醒**
   - 喝水不足、待办太多、睡眠不足等

3. **AI 的提醒是智能的**
   - 基于实时数据
   - 结合上下文场景
   - 温和而不打扰

4. **所有数据都在本地**
   - 只在发送给 AI 时作为上下文
   - AI 不会永久存储
   - 每次对话都重新传递

5. **AI 可以修改状态**
   - 通过工具调用（addTodo、addWater等）
   - 自动更新界面
   - 实时同步显示

---

**更新日期**: 2026-01-17  
**相关文件**: 
- `services/geminiService.ts` - AI 服务和工具定义
- `App.tsx` - 状态管理和数据传递
- `types.ts` - 数据类型定义
